let _d_;const dMap=new Map,rMap=new WeakMap,dp=Object.defineProperty,doc=document,observe=t=>rctr((()=>{const e=_d_;_d_=t;const n=t();return _d_=e,n})),rctr=t=>{let e=t.valueOf();const n=Reflect,r=t=>{const e=dMap.get(t);for(let t of[...e||[]])"function"==typeof t?t():t.isConnected?t.isConnected&&t!==this&&rMap.get(t)?.call(t):e.delete(t)},o=()=>"function"==typeof e?e():e,a=new Proxy(t,{get(t,e){if("toJSON"===e||"valueOf"===e)return()=>o();if("toString"===e)return()=>o().toString();if("isReactor"===e)return!0;if("peek"===e)return o();_d_&&dMap.set(t,(dMap.get(t)||new Set).add(_d_));const r="value"===e?o():n.get(t,e);return r?.isReactor?r:r&&"object"==typeof r?t[e]=rctr(r):r},set:(t,o,a)=>(e!==a&&("value"===o?e=a:n.set(t,o,a),r(t)),!0),deleteProperty(t,o){let a=!0;"value"===o?e=void 0:n.deleteProperty(t,o,v),r(t)}});return"function"==typeof t&&o(),a},state=t=>({object:t=>t?rctr(t):t,function:t=>rctr(t),boolean:t=>rctr(new Boolean(t)),number:t=>rctr(new Number(t)),string:t=>rctr(new String(t)),bigint:t=>rctr(new BigInt(t)),undefined(t){}}[typeof t](t)),tags=new Proxy({},{get:(t,e)=>(t,...n)=>function r(){t?(r.attrs=t,n&&(r.children=n),"function"==typeof t&&(t=t())):(t="function"==typeof r.attrs?r.attrs():r.attrs||{},n=r.children);const o=_d_,a=doc.createElement(e),c=typeof t;(["string","number","boolean","bigint"].some((e=>e===c||e===t.constructor.name.toLowerCase()))||"object"===c&&(t instanceof Node||t instanceof Array))&&(n=[t,...n],t={}),n=n.flat(),rMap.set(a,r),_d_=a,!t.oncreate||t.oncreate(dp(new Event("create",{bubbles:!0,cancelable:!1}),"target",{value:a}));for(let e in t){if(!isNaN(parseInt(e)))continue;if(e.startsWith("on")){a.addEventListener(e.substring(2).toLowerCase(),(async n=>{const r=_d_;_d_=n.target,await t[e](n),_d_=r}));continue}const n="function"==typeof t[e]?t[e].call(a):t[e],r=typeof n;"style"===e&&"object"===r?Object.assign(a.style,n):"dataset"===e?Object.assign(a.dataset,n):"value"===e?a.value=n:a.setAttribute(e,n&&"object"===r?JSON.stringify(n):n),"href"===e&&trui.load&&dp(a,"load",{configurable:!0,value:trui.load})}for(let t of n)"function"==typeof t&&(t=t()),t.nodeType===Node.TEXT_NODE||t&&"object"==typeof t&&t instanceof Node?a.appendChild(t):a.appendChild(doc.createTextNode(t+""));return _d_=o,this instanceof Node&&(rMap.delete(this),this.replaceWith(a)),a}()}),trui=({load:t}={})=>(t&&(trui.load=t),trui);Object.assign(trui,{tags:tags,state:state,observe:observe});export{trui,trui as default};